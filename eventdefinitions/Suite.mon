package com.dtamai.onspec;

event Suite {

  /** @private */
  wildcard integer _id;

  /** @private */
  SpecRunner _runner;

  /** @private */
  SpecReporter _reporter;

  action describe(string text) returns integer {
    return _runner.addContext(text);
  }

  action it(string text) returns integer {
    return _runner.addSpec(text);
  }

  action T(string tags) {
    _runner.addTags(tags);
  }

  action init(action<> runnable) {
    self._id := integer.getUnique();
    on all NewSuite() -> _SpecDiscover() {
      spawn _handleNewSuite(runnable);
    }
  }

  action pass() {
    _reporter.pass();
  }

  action skip() {
    _reporter.skip();
  }

  action fail(string reason) {
    _reporter.fail(reason);
  }

  action done() {
    _reporter.pass();
  }

  /** @private */
  action _handleNewSuite(action<> runnable) {
    route _SpecPresent(self._id);
    on _SpecBegin(_id) {
      _runner.run(runnable, self._id);
    }
  }
}
